<p><strong>sumolib</strong> is a set of python modules for working with sumo networks, simulation output and other simulation artifacts. For a detailed list of available functions see the <a href="http://sumo.dlr.de/daily/pydoc/sumolib.html">pydoc generated documentation</a>. You can <a href="https://github.com/DLR-TS/sumo/tree/master/tools/sumolib">browse the code here</a>.</p>

<p><strong>TOC</strong></p>

<h1 id="importing-sumolib-in-a-script">importing <strong>sumolib</strong> in a script</h1>

<p>To use the library, the /tools directory must be on the python load path. This is typically done with a stanza like this:</p>

<p><code class="highlighter-rouge"> import os, sys</code>
<code class="highlighter-rouge"> if 'SUMO_HOME' in os.environ:</code>
<code class="highlighter-rouge">     tools = os.path.join(os.environ['SUMO_HOME'], 'tools')</code>
<code class="highlighter-rouge">     sys.path.append(tools)</code>
<code class="highlighter-rouge"> else:   </code>
<code class="highlighter-rouge">     sys.exit(</code>“<code class="highlighter-rouge">please</code><code class="highlighter-rouge"> </code><code class="highlighter-rouge">declare</code><code class="highlighter-rouge"> </code><code class="highlighter-rouge">environment</code><code class="highlighter-rouge"> </code><code class="highlighter-rouge">variable</code><code class="highlighter-rouge"> </code><code class="highlighter-rouge">'SUMO_HOME'</code>”<code class="highlighter-rouge">)</code></p>

<h1 id="usage-examples">usage examples</h1>

<h2 id="import-a-network-and-retrieve-nodes-and-edges">import a network and retrieve nodes and edges</h2>

<p><code class="highlighter-rouge"> # import the library</code>
<code class="highlighter-rouge"> import sumolib</code>
<code class="highlighter-rouge"> # parse the net</code>
<code class="highlighter-rouge"> net = sumolib.net.readNet('myNet.net.xml')</code></p>

<p><code class="highlighter-rouge"> # retrieve the coordinate of a node based on its ID</code>
<code class="highlighter-rouge"> print net.getNode('myNodeID').getCoord()</code></p>

<p><code class="highlighter-rouge"> # retrieve the successor node ID of an edge</code>
<code class="highlighter-rouge"> nextNodeID = net.getEdge('myEdgeID').getToNode().getID()</code></p>

<h2 id="compute-the-average-and-median-edge-length-in-a-plain-xml-edge-file">compute the average and median edge length in a <em>plain xml</em> edge file</h2>

<p><code class="highlighter-rouge"> # compute the average length</code>
<code class="highlighter-rouge"> lengthSum = 0.0</code>
<code class="highlighter-rouge"> edgeCount = 0</code>
<code class="highlighter-rouge"> for edge in sumolib.output.parse('myNet.edg.xml', ['edge']):</code>
<code class="highlighter-rouge">     lengthSum += float(edge.length)</code>
<code class="highlighter-rouge">     edgeCount += 1</code>
<code class="highlighter-rouge"> avgLength = lengthSum / edgeCount</code></p>

<p><code class="highlighter-rouge"> # compute the median length using the </code><a href="http://sumo-sim.org/daily/pydoc/sumolib.miscutils.html#Statistics"><code class="highlighter-rouge">Statistics</code></a><code class="highlighter-rouge"> module</code>
<code class="highlighter-rouge"> edgeStats = sumolib.miscutils.Statistics(</code>“<code class="highlighter-rouge">edge</code><code class="highlighter-rouge"> </code><code class="highlighter-rouge">lengths</code>”<code class="highlighter-rouge">)</code>
<code class="highlighter-rouge"> for edge in sumolib.output.parse('myNet.edg.xml', ['edge']):</code>
<code class="highlighter-rouge">     edgeStats.add(float(edge.length))</code>
<code class="highlighter-rouge"> avgLength = edgeStats.median()</code></p>

<h2 id="locate-nearby-edges-based-on-the-geo-coordinate">locate nearby edges based on the geo-coordinate</h2>

<p><code class="highlighter-rouge"> # (requires module </code><a href="https://code.google.com/p/pyproj/"><code class="highlighter-rouge">pyproj</code></a><code class="highlighter-rouge"> to be installed)</code>
<code class="highlighter-rouge"> # for larger networks </code><a href="https://pypi.org/project/Rtree/"><code class="highlighter-rouge">rtree</code></a><code class="highlighter-rouge"> is also strongly recommended</code>
<code class="highlighter-rouge"> radius = 0.1</code>
<code class="highlighter-rouge"> x, y = net.convertLonLatXY(lon, lat)</code>
<code class="highlighter-rouge"> edges = net.getNeighboringEdges(x, y, radius)</code>
<code class="highlighter-rouge"> # pick the closest edge</code>
<code class="highlighter-rouge"> if len(edges) &gt; 0:</code>
<code class="highlighter-rouge">   distancesAndEdges = sorted([(dist, edge) for edge, dist in edges])</code>
<code class="highlighter-rouge">   dist, closestEdge = distancesAndEdges[0]</code></p>

<h2 id="parse-all-edges-in-a-route-file">parse all edges in a route file</h2>

<p><code class="highlighter-rouge"> for route in sumolib.output.parse_fast(</code>“<code class="highlighter-rouge">myRoutes.rou.xml</code>”<code class="highlighter-rouge">, 'route', ['edges']):</code>
<code class="highlighter-rouge">     edge_ids = route.edges.split()</code>
<code class="highlighter-rouge">     # do something with the vector of edge ids</code></p>

<h2 id="coordinate-transformations">coordinate transformations</h2>

<p><code class="highlighter-rouge"> x, y = traci.vehicle.getPosition(vehID)</code>
<code class="highlighter-rouge"> lon, lat = traci.simulation.convertGeo(x, y)</code>
<code class="highlighter-rouge"> x2, y2 = traci.simulation.convertGeo(lon, lat, fromGeo=True)</code></p>
